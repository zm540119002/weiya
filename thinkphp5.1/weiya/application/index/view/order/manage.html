{extend name="template/base.html" /}
{block name="css-customize"}
{/block}
{block name="nav">我的订单{/block}
{block name="content"}
<article class="f24 ">
    <section class="header_title separation-line">
		<h2 class="f24">我的订单</h2>
	</section>
    <section class="order_main_wrapper">
        <nav>
            <ul class="menu_nav">
                <li>
                    <a href="{:url('order/manage')}">全部</a>
                </li>
                <li>
                    <a href="{:url('order/manage',['order_status'=>1])}">待付款</a>
                </li>
                <li>
                    <a href="{:url('order/manage',['order_status'=>2])}">待收货</a>
                </li>
                <li>
                    <a href="{:url('order/manage',['order_status'=>3])}">待评价</a>
                </li>
                <li>
                    <a href="{:url('order/manage',['order_status'=>4])}">已完成</a>
                </li>
            </ul>
        </nav>
        <ul class="order_list list" id="list">

        </ul>
    </section>
</article>
{/block}
{block name="footer"}
{include file="template/footer_menu.html" /}
{/block}

{block name="script"}
    <script type="text/javascript" src="weiya_js/footerCart.js"></script>
    <script type="text/javascript" src="public_js/paging.js"></script>
    <script type="text/javascript">
        var config = {
            url:module+'Order/getList',
            requestEnd:false,
            loadTrigger:false,
            currentPage:1,

        };
        var postData = {
            pageSize:4,
            pageType:'list_tpl'
        };
        $(function(){
            var order_status={:json_encode($order_status)};
            order_status=parseInt(order_status);
            switch(order_status){
                case 1:
                $('.menu_nav li').eq(order_status).addClass('current');
                break;
                case 2:
                $('.menu_nav li').eq(order_status).addClass('current');
                break;
                case 3:
                $('.menu_nav li').eq(order_status).addClass('current');
                break;
                case 4:
                $('.menu_nav li').eq(order_status).addClass('current');
                break;
            }
            if(order_status){
                postData.order_status = order_status;
            }
            getPagingList(config,postData);

            //下拉加载
            $(window).on('scroll',function(){
                if(config.loadTrigger && $(document).scrollTop()+$(window).height()+200>$(document).height()){
                    config.loadTrigger = false;
                    getPagingList(config,postData);
                }
            });

            //取消订单
            $('body').on('click','.cancel_order',function () {
                var _this = $(this);
                var _thisTr =_this.parents('li');
                var id = _thisTr.data('id');
                var postData ={
                    id:id,
                    auth_status:5
                };
                console.log(postData);return false;
                var url = module+'Order/setOrderStatus';
                layer.open({
                    content:'是否退出？',
                    btn:['确定','取消'],
                    yes:function(index){
                        $.ajax({
                            url: url,
                            data: postData,
                            type: 'post',
                            beforeSend: function(){
                                $('.loading').show();
                            },
                            error:function(){
                                $('.loading').hide();
                                dialog.error('AJAX错误');
                            },
                            success: function(data){
                                $('.loading').hide();
                                if(data.status){

                                }
                            }
                        });
                        layer.close(index);
                    }
            })

        });
    </script>
{/block}