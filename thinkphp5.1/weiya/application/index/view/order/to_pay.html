{extend name="template/base.html" /}
{block name="css-customize"}
{/block}
{block name="content"}
<article class="f24 pay_wrapper">
    <section class="pay_amount_item content-padding">
        <div>订单金额：<span class="red">￥<price>{$orderInfo.amount}</price></span></div>
    </section>
    <section class="content-padding ">
        <p class="content-label">选择支付方式</p>
        <div>
            <ul class="pay_nav">
                <li data-paycode="1">
                    微信支付
                    <!--<input type="checkbox" checked="checked" class=""/>-->
                    <span class="selected"></span>
                    <span class="wx"></span>
                </li>
                <li data-paycode="2" id="alipay">
                    支付宝支付
                    <!--<input type="checkbox" class=""/>-->
                    <span class="selected"></span>
                    <span class="wx"></span>
                </li>
                <li data-paycode="3">银联支付
                    <!--<input type="checkbox" class=""/>-->
                    <span class="selected"></span>
                    <span class="wx"></span>
                </li>
                {if $walletInfo.amount >= $orderInfo.amount}
                <li data-paycode="4" >
                {else /}
                <li data-paycode="4" class="disabled">
                {/if}
                    钱包支付
                    <!--<input type="checkbox" checked="checked" class=""/>-->
                    <span class="selected"></span>
                    {notempty name="walletInfo"}
                    <span class="wx">余额：￥<price>{$walletInfo.amount}</price></span>
                    {else /}
                    <span class="wx">余额：￥<price>0.00</price></span>
                    {/notempty}

                </li>
            </ul>
        </div>
        <p>*线下银行转账/现金支付需将证据拍照上传</p>
        <form action="{:url('Payment/orderPayment')}" method="post" class="pay_form" id="pay_info">
            <input type="hidden" name="order_sn" value="{$orderInfo.sn}"/>
            <input type="hidden" name="pay_code" value="" class="pay_code"/>
            <input type="submit" value="立即支付" class="pay_btn"/>
        </form>
    </section>
</article>
{/block}
{block name="common"}
{include file="template/wallet_password_dialog.html" /}
{include file="template/forget_wallet_password_dialog.html" /}
{/block}
{block name="script"}
<script type="text/javascript" src="public_js/wallet.js"></script>
<script type="text/javascript">
    $(function(){
        //如果是微信浏览器
        if(isWeiXin()){
            $('#alipay').remove();
        }
        $('.pay_nav li').on('click',function(){
            $(this).addClass('current').siblings().removeClass('current');
            var pay_code = $(this).data('paycode');
            $(this).find('input[type="checkbox"]').prop('checked',true);
            $('.pay_code').val(pay_code);
        });

        $('body').on('click','.pay_btn',function () {
            var pay_code = $('input[name=pay_code]').val();
            if(!pay_code){
                dialog.error('请选择支付方式');
                return false;
            }
            if(pay_code == 4){
                var data = $('#pay_info').serializeObject()
                walletPayDialog('orderPayment',data);
                return false
            }
        });

        $('body').on('click','.forget_wallet_password',function () {
            var pay_code = $('input[name=pay_code]').val();
            var data = $('#pay_info').serializeObject();
            data.pay_code = pay_code;
            forgetWalletPasswordDialog('orderPayment',data)
        })
    });
</script>
{/block}