{extend name="template/base.html" /}
{block name="css-customize"}
<link rel="stylesheet" href="factory_css/main.css">
{/block}
{block name="content"}
<article class="f24">
	<section class="slider_banner">
		<div class="swiper-container swiper-container-horizontal swiper-container-ios">
			<div class="swiper-wrapper">
				{notempty name="info.goods_video"}
				<div class="swiper-slide swiper-slide-active">
					<video  src="public_uploads/{$info.goods_video}" autoplay="autoplay"></video>
				</div>
				{/notempty}
				{empty name="info.main_img"}
				<div class="swiper-slide swiper-slide-active">
					<img src="public_img/default/no_pic_100.jpg" alt="">
				</div>
				{else /}
				{volist name="info.main_img" id="main_img"}
				<div class="swiper-slide swiper-slide-active">
					<img src="public_uploads/{$main_img}" alt="" class="common_default_img">
				</div>
				{/volist}
				{/empty}
			</div>
			<div class="swiper-pagination swiper-pagination-clickable swiper-pagination-bullets">
				<span class="swiper-pagination-bullet swiper-pagination-bullet-active" tabindex="0" role="button" aria-label="Go to slide 1"></span>
				<span class="swiper-pagination-bullet " tabindex="0" role="button" aria-label="Go to slide 2"></span>
				<span class="swiper-pagination-bul let " tabindex="0" role="button" aria-label="Go to slide 3"></span>
				<span class="swiper-pagination-bullet " tabindex="0" role="button" aria-label="Go to slide 4"></span>
			</div>
		</div>
	</section>
	<section class="module-navigation ">
		<div >
			<ul class="goods_list">
				<li data-id='{$info.id}' data-buy_type="1">
					<div class="top_radius f20 top_module">
						<div class="columns_flex l-r-sides">
							<div>
								<span class="red">￥<price class="sale_price">{$info.bulk_price}</price></span>
							</div>
							<div>
								<a class="qrcode_share"  href="javascript:void(0);"></a>
							</div>
						</div>
						<div>
							<span class="hot left">热</span>
							<p class="title_name f28">{$info.headline}</p>
						</div>
						<!--<p class="specification_text">{$info.specification}</p>
						<p class="product_intro">{$info.intro|raw}</p>-->
						<div class="tags_item columns_flex l-r-sides">
							<div>
								{volist name="$info.tag" id="tag"}
								<span>{$tag}</span>
								{/volist}
							</div>
							<div class="tags_item_r">
								<a class="collection" href=""><span></span>收藏</a>
								<a class="share" href=""><span></span>分享</a>
							</div>
						</div>
					</div>
					<div class="content-padding">
						<p class="top_b_text wk_notice separation">[品牌定制须知] 品牌定制利润为王！维雅生物药妆精选优质项目产品任你选，帮助用户开启自主品牌可持续发展经营！用户在线选购产品并支付品牌定制单，其他全部交给维雅品牌定制服务团队。</p>
						<div class="columns_flex l-r-sides separation">
							<div class="mid_module_left">
								<img src="public_img/wy_dz.png" alt="">
								<div>
									<span class="left count-down-icons"></span>
									<div class="d-r">
										<p class="friday_end">品牌定制<span>.</span>周五截止</p>
										<div id="countDownBox" class="count_down_box">
											<span class="day"></span>天
											<span class="hour"></span>小时
											<span class="minute"></span>分
											<span class="second"></span>秒
										</div>
									</div>
								</div>
							</div>
							<div class="mid_module_right">
								<span><span class="item end_time"></span>周五结单</span>
								<span><span class="item factory"></span>品质工厂</span>
							</div>
						</div>
						<div class="columns_flex l-r-sides">
							<div>
								我的品牌定制<span>xxxxx</span>
							</div>
							<div>
								<a>设定></a>
							</div>
						</div>
					</div>
					<div class="content-padding columns_flex l-r-sides">
						<div>
							<p>起订数量:<span class="order_quantity">{$info.minimum_order_quantity}{$info.purchase_unit|getUnit}</span>
							</p>
							<p>采购数量(单位:{$info.purchase_unit|getUnit})</p>
						</div>
						<div class="quantity_wrapper selected-number">
							<a href="javascript:void(0);" class="greduce">-</a>
							<input type="text" value="{$info.minimum_order_quantity}" class="f24 gshopping_count">
							<input type="hidden" class="minimum_order_quantity" value="{$info.minimum_order_quantity}">
							<input type="hidden" class="increase_quantity" value="{$info.increase_quantity}">
							<a href="javascript:void(0);" class="gplus">+</a>
						</div>
						<div>
							<a href="javascript:void(0);" class="sample_purchase" >样品购买</a>
						</div>
					</div>
				</li>
			</ul>
		</div>
	</section>
	<div class="scrollwrapper">
		<div id="menu">
            <ul class="columns_flex detail-nav">
                <li data-item="item1" ><a href="javascript:;" class="">商品参数</a></li>
                <li data-item="item2" ><a href="javascript:;" class="">商品详情</a></li>
                <li data-item="item3" ><a href="javascript:;" class="">评分评价</a></li>
            </ul>
        </div>
		<div id="content" class="floor-content">
			<div id="item1" class="floor">
				<div class="floor_item">
					<p class="content-label">商品参数</p>
					<p>{$info.parameters|raw}</p>
				</div>
			</div>
			<div id="item2" class="floor">
				<div class="floor_item">
					<p class="content-label">商品详情</p>
					{volist name="info.detail_img" id="detail_img"}
					<div class="">
						<img src="public_uploads/{$detail_img}" alt="" class="common_default_img">
					</div>
					{/volist}
				</div>
			</div>
			<div id="item3" class="floor">
				<div class="floor_item" >
					<p>评分评价</p>
					<div class="goods_star_score"  >
						<div class="five_star">
							<div class="star_img">
								<img src="public_img/starred.png" id="0">
								<img src="public_img/starred.png" id="1">
								<img src="public_img/starred.png" id="2">
								<img src="public_img/star.png" id="3">
								<img src="public_img/star.png" id="4">
							</div>
							<span class="fraction" data-score="3.9">{$averageScore}分</span>
						</div>
						<a href="javascript:void(0);" class="comment_num">{$total}人评论</a>
					</div>
					<ul class="sales_comment_wrapper" id="commentList">

					</ul>
					<div class="page"><a class="comment-next-page" href="javascript:void(0);" data-page="{$nextPage}">加载更多评论&nbsp;V</a></div>
				</div>
			</div>
		</div>
	</div>
	<div id="recommendGoodsList" class="recommendGoodsList"></div>

</article>
<div class="mod_slider_mask" id="blackCover" style="display:none;"></div>
<div class="mod_slider mod_slider_s1 mod_slider_viewer" id="evalLoopImg" style="display:none;height: 375px;">
	<div class="inner">
		<!--<ul>
            <li>1111</li>
        </ul>-->
		<div class="swiper-container swiper-container-horizontal swiper-container-ios">
			<div class="swiper-wrapper">
				<div class="swiper-slide swiper-slide-active">
					<img src="public/static/common/img/banner/home-banner1.jpg" alt="" class="common_default_img">
				</div>
				<div class="swiper-slide ">
					<img src="public/static/common/img/banner/home-banner2.jpg" alt="" class="common_default_img">
				</div>
				<div class="swiper-slide ">
					<img src="public/static/common/img/banner/home-banner3.jpg" alt="" class="common_default_img">
				</div>
				<div class="swiper-slide ">
					<img src="public/static/common/img/banner/home-banner.jpg" alt="" class="common_default_img">
				</div>
			</div>
			<div class="swiper-pagination swiper-pagination-clickable swiper-pagination-bullets">
				<span class="swiper-pagination-bullet swiper-pagination-bullet-active" tabindex="0" role="button" aria-label="Go to slide 1"></span>
				<span class="swiper-pagination-bullet " tabindex="0" role="button" aria-label="Go to slide 2"></span>
				<span class="swiper-pagination-bul let " tabindex="0" role="button" aria-label="Go to slide 3"></span>
				<span class="swiper-pagination-bullet " tabindex="0" role="button" aria-label="Go to slide 4"></span>
			</div>
		</div>
	</div>
</div>
{/block}
{block name="common"}
	{include file="public/sample_layer" /}
{/block}
{block name="footer"}
	{include file="template/footer_menu.html" /}
{/block}
{block name="script"}
<script type="text/javascript" src="public_js/swiper.min.js"></script>
<script type="text/javascript" src="public_js/paging.js"></script>
<script type="text/javascript" src="weiya_js/footerCart.js"></script>
<script type="text/javascript">
	$(function(){
		var id = {$info.id};
		var order_quantity={:json_encode($info.minimum_order_quantity)};
		$('.gshopping_count').val(order_quantity);
		//轮播
		var swiper = new Swiper('.swiper-container', {
			spaceBetween: 30,
			autoplay:true,
			pagination: {
				el: '.swiper-pagination',
				clickable: true
			}
		});
		var height=$('.detail-nav').height();
		var offsetHeight=$('.detail-nav').offset().top;
		$(window).on('scroll',function(){
			var scrollHeight=$(document).scrollTop();

			if(scrollHeight>offsetHeight){
				$('.detail-nav').addClass('top-fixed');
			}else {
				$('.detail-nav').removeClass('top-fixed');
			}
		});
		
		// $('.scrollwrapper').scrollFloor();
		//楼层
		var menu = $('#menu');						
		var items = $('#content').find('.floor');	
		var height=$('.detail-nav').height();
		var offsetHeight=$('.detail-nav').offset().top;
				console.log(height);
		$(window).scroll(function() {
			//滚动
			var top = $(document).scrollTop();			
			var currentId = '';
			var top=$(document).scrollTop();
			if(top>offsetHeight){
				$('.detail-nav').addClass('top-fixed');
			}else {
				$('.detail-nav').removeClass('top-fixed');
			}
			items.each(function(){
				var m = $(this);
				var itemTop = m.offset().top;			
				if(top + 43>= itemTop ){
					//currentId = '#' + m.attr('id');
					currentId = m.attr('id');
				} else {
					return false;
				}
			});

			// 给相应楼层的a 设置 current, 取消其他链接的current
			var currentLink = menu.find('.active');
			if(currentId && currentLink.data('item') != currentId) {
				currentLink.removeClass('active');
				menu.find("[data-item='"+ currentId +"']").addClass('active').siblings().removeClass('active');
			}
		});
		$('#menu li').on('click',function(){
			var _this=$(this);
			var id=_this.data('item');
			items.each(function(){
				var m = $(this);
				if(m.attr('id')==id){
					var itemTop = m.offset().top;
					_this.addClass('active').siblings().removeClass('active');
				var scrollY=itemTop-40;	
					$('html, body').animate({
						scrollTop: scrollY
					},500);
				}else{
					_this.removeClass('active');
				} 
			});
		});

		//获取评论
		var config = {
			url:module+'Comment/getList',
			currentPage:1,
			container:$('#commentList'),
			type:'click'
		};
		var getData = {
			pageSize:6,
			goods_id:id
		};
		getPagingListByClick(config,getData);
		//加载更多评论
		$('body').on('click','.comment-next-page',function (){
			var page = $(this).data('page');
			var	pageIndex=parseInt(page)+1;
			$(this).data('page',pageIndex);
			config.currentPage = page;
			getPagingListByClick(config,getData);
		});

		//获取推荐商品
		var url = module + 'Goods/getRecommendGoods';
		$.ajax({
			url: url,
			data: {goods_id:id},
			type: 'get',
			beforeSend: function(){
				$('.loading').show();
			},
			error:function(){
				$('.loading').hide();
				dialog.error('AJAX错误');
			},
			success: function(data){
				$('#recommendGoodsList').html(data);
			}
		});

		//打开二维码
		$('body').on('click','.qrcode_share',function (){
			var rq_code_url = "{$info.rq_code_url}";
			if(rq_code_url){
				var imgSrc=uploads+rq_code_url;
				var scrollTop;
				layer.open({
					skin:'shareqrCodeLayer',
					content:'<img src='+imgSrc+' />',
					btn:['X'],
					success:function(){
						scrollTop = $(document).scrollTop();//获取当前滚动条位置
						$("body").addClass("flexd");//设置绝对定位，此时不操作的话底层页面回到最初位置
						$("body").css("top",-scrollTop);//设置top属性确保屏幕显示滚动条的当前位置
					},
					yes:function(index){
						$("body").removeClass("flexd");//取消绝对定位
						$("body").scrollTop(scrollTop);//滚动条回到停留位置
						layer.close(index);
					}
				})
			}
		});
		//活动倒计时
		var date=getWeek();
		countDown(date,$('#countDownBox'));
		//设置分数
		var averageScore = {$averageScore};
		$('.five_star').setStar(parseFloat(averageScore));
	});
</script>
{/block}